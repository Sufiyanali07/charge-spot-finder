{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"map-view\"\n};\nconst _hoisted_2 = {\n  class: \"row\"\n};\nconst _hoisted_3 = {\n  class: \"col-md-8\"\n};\nconst _hoisted_4 = {\n  class: \"card mb-4\"\n};\nconst _hoisted_5 = {\n  class: \"card-body p-0\"\n};\nconst _hoisted_6 = {\n  id: \"map\",\n  ref: \"mapContainer\",\n  class: \"map-container\"\n};\nconst _hoisted_7 = {\n  class: \"col-md-4\"\n};\nconst _hoisted_8 = {\n  class: \"card mb-4\"\n};\nconst _hoisted_9 = {\n  class: \"card-body\"\n};\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  class: \"mb-2\"\n};\nconst _hoisted_12 = {\n  class: \"station-details\"\n};\nconst _hoisted_13 = {\n  key: 0,\n  class: \"mb-2\"\n};\nconst _hoisted_14 = {\n  class: \"mb-2\"\n};\nconst _hoisted_15 = {\n  class: \"mb-2\"\n};\nconst _hoisted_16 = {\n  key: 1,\n  class: \"mb-2\"\n};\nconst _hoisted_17 = {\n  key: 2,\n  class: \"mb-2\"\n};\nconst _hoisted_18 = {\n  class: \"mb-2 text-muted\"\n};\nconst _hoisted_19 = {\n  key: 0,\n  class: \"mt-3\"\n};\nconst _hoisted_20 = {\n  key: 1,\n  class: \"text-center py-4\"\n};\nconst _hoisted_21 = {\n  class: \"card\"\n};\nconst _hoisted_22 = {\n  class: \"card-body\"\n};\nconst _hoisted_23 = {\n  class: \"mb-3\"\n};\nconst _hoisted_24 = {\n  class: \"mb-3\"\n};\nconst _hoisted_25 = {\n  key: 0,\n  class: \"modal fade show\",\n  style: {\n    \"display\": \"block\",\n    \"background-color\": \"rgba(0,0,0,0.5)\"\n  }\n};\nconst _hoisted_26 = {\n  class: \"modal-dialog\"\n};\nconst _hoisted_27 = {\n  class: \"modal-content\"\n};\nconst _hoisted_28 = {\n  class: \"modal-header\"\n};\nconst _hoisted_29 = {\n  class: \"modal-body\"\n};\nconst _hoisted_30 = {\n  class: \"modal-footer\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[35] || (_cache[35] = _createElementVNode(\"h2\", {\n    class: \"mb-3\"\n  }, \"Charging Stations Map\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createCommentVNode(\" Map Container \"), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, null, 512 /* NEED_PATCH */)])])]), _createElementVNode(\"div\", _hoisted_7, [_createCommentVNode(\" Station Details Panel \"), _createElementVNode(\"div\", _hoisted_8, [_cache[27] || (_cache[27] = _createElementVNode(\"div\", {\n    class: \"card-header bg-primary text-white\"\n  }, [_createElementVNode(\"h5\", {\n    class: \"mb-0\"\n  }, \"Station Details\")], -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_9, [$data.selectedStation ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createElementVNode(\"h4\", null, _toDisplayString($data.selectedStation.name), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"span\", {\n    class: _normalizeClass($options.getStatusBadgeClass($data.selectedStation.status))\n  }, _toDisplayString($data.selectedStation.status), 3 /* TEXT, CLASS */)]), _createElementVNode(\"div\", _hoisted_12, [$data.selectedStation.address ? (_openBlock(), _createElementBlock(\"p\", _hoisted_13, [_cache[9] || (_cache[9] = _createElementVNode(\"i\", {\n    class: \"bi bi-geo-alt\"\n  }, null, -1 /* HOISTED */)), _cache[10] || (_cache[10] = _createTextVNode()), _cache[11] || (_cache[11] = _createElementVNode(\"strong\", null, \"Address:\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($data.selectedStation.address), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"p\", _hoisted_14, [_cache[12] || (_cache[12] = _createElementVNode(\"i\", {\n    class: \"bi bi-lightning-charge\"\n  }, null, -1 /* HOISTED */)), _cache[13] || (_cache[13] = _createTextVNode()), _cache[14] || (_cache[14] = _createElementVNode(\"strong\", null, \"Power Output:\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($data.selectedStation.powerOutput) + \" kW \", 1 /* TEXT */)]), _createElementVNode(\"p\", _hoisted_15, [_cache[15] || (_cache[15] = _createElementVNode(\"i\", {\n    class: \"bi bi-plug\"\n  }, null, -1 /* HOISTED */)), _cache[16] || (_cache[16] = _createTextVNode()), _cache[17] || (_cache[17] = _createElementVNode(\"strong\", null, \"Connector Type:\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($data.selectedStation.connectorType), 1 /* TEXT */)]), $data.selectedStation.pricePerKwh ? (_openBlock(), _createElementBlock(\"p\", _hoisted_16, [_cache[18] || (_cache[18] = _createElementVNode(\"i\", {\n    class: \"bi bi-currency-dollar\"\n  }, null, -1 /* HOISTED */)), _cache[19] || (_cache[19] = _createTextVNode()), _cache[20] || (_cache[20] = _createElementVNode(\"strong\", null, \"Price:\", -1 /* HOISTED */)), _createTextVNode(\" $\" + _toDisplayString($data.selectedStation.pricePerKwh) + \" per kWh \", 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), $data.selectedStation.availableHours ? (_openBlock(), _createElementBlock(\"p\", _hoisted_17, [_cache[21] || (_cache[21] = _createElementVNode(\"i\", {\n    class: \"bi bi-clock\"\n  }, null, -1 /* HOISTED */)), _cache[22] || (_cache[22] = _createTextVNode()), _cache[23] || (_cache[23] = _createElementVNode(\"strong\", null, \"Hours:\", -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($data.selectedStation.availableHours.open) + \" - \" + _toDisplayString($data.selectedStation.availableHours.close), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"p\", _hoisted_18, [_createElementVNode(\"small\", null, \"Added by: \" + _toDisplayString($data.selectedStation.owner?.username || 'Unknown'), 1 /* TEXT */)])]), $options.canManageStation($data.selectedStation) ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [_createVNode(_component_router_link, {\n    to: `/stations/${$data.selectedStation._id}/edit`,\n    class: \"btn btn-sm btn-outline-secondary me-2\"\n  }, {\n    default: _withCtx(() => _cache[24] || (_cache[24] = [_createElementVNode(\"i\", {\n      class: \"bi bi-pencil\"\n    }, null, -1 /* HOISTED */), _createTextVNode(\" Edit \")])),\n    _: 1 /* STABLE */,\n    __: [24]\n  }, 8 /* PROPS */, [\"to\"]), _createElementVNode(\"button\", {\n    class: \"btn btn-sm btn-outline-danger\",\n    onClick: _cache[0] || (_cache[0] = $event => $options.confirmDelete($data.selectedStation))\n  }, _cache[25] || (_cache[25] = [_createElementVNode(\"i\", {\n    class: \"bi bi-trash\"\n  }, null, -1 /* HOISTED */), _createTextVNode(\" Delete \")]))])) : _createCommentVNode(\"v-if\", true)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_20, _cache[26] || (_cache[26] = [_createElementVNode(\"i\", {\n    class: \"bi bi-map-fill text-muted\",\n    style: {\n      \"font-size\": \"3rem\"\n    }\n  }, null, -1 /* HOISTED */), _createElementVNode(\"p\", {\n    class: \"mt-3 text-muted\"\n  }, \"Select a station on the map to view details\", -1 /* HOISTED */)])))])]), _createCommentVNode(\" Filter Panel \"), _createElementVNode(\"div\", _hoisted_21, [_cache[32] || (_cache[32] = _createElementVNode(\"div\", {\n    class: \"card-header bg-light\"\n  }, [_createElementVNode(\"h5\", {\n    class: \"mb-0\"\n  }, \"Filters\")], -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_22, [_createElementVNode(\"div\", _hoisted_23, [_cache[29] || (_cache[29] = _createElementVNode(\"label\", {\n    for: \"statusMapFilter\",\n    class: \"form-label\"\n  }, \"Status\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    id: \"statusMapFilter\",\n    class: \"form-select\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.mapFilters.status = $event),\n    onChange: _cache[2] || (_cache[2] = (...args) => $options.applyMapFilters && $options.applyMapFilters(...args))\n  }, _cache[28] || (_cache[28] = [_createElementVNode(\"option\", {\n    value: \"\"\n  }, \"All Statuses\", -1 /* HOISTED */), _createElementVNode(\"option\", {\n    value: \"Active\"\n  }, \"Active\", -1 /* HOISTED */), _createElementVNode(\"option\", {\n    value: \"Inactive\"\n  }, \"Inactive\", -1 /* HOISTED */), _createElementVNode(\"option\", {\n    value: \"Maintenance\"\n  }, \"Maintenance\", -1 /* HOISTED */)]), 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelSelect, $data.mapFilters.status]])]), _createElementVNode(\"div\", _hoisted_24, [_cache[31] || (_cache[31] = _createElementVNode(\"label\", {\n    for: \"connectorMapFilter\",\n    class: \"form-label\"\n  }, \"Connector Type\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    id: \"connectorMapFilter\",\n    class: \"form-select\",\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.mapFilters.connectorType = $event),\n    onChange: _cache[4] || (_cache[4] = (...args) => $options.applyMapFilters && $options.applyMapFilters(...args))\n  }, _cache[30] || (_cache[30] = [_createStaticVNode(\"<option value=\\\"\\\" data-v-a774b752>All Connectors</option><option value=\\\"Type 1\\\" data-v-a774b752>Type 1</option><option value=\\\"Type 2\\\" data-v-a774b752>Type 2</option><option value=\\\"CCS\\\" data-v-a774b752>CCS</option><option value=\\\"CHAdeMO\\\" data-v-a774b752>CHAdeMO</option><option value=\\\"Tesla\\\" data-v-a774b752>Tesla</option>\", 6)]), 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelSelect, $data.mapFilters.connectorType]])]), _createElementVNode(\"button\", {\n    class: \"btn btn-secondary w-100\",\n    onClick: _cache[5] || (_cache[5] = (...args) => $options.resetMapFilters && $options.resetMapFilters(...args))\n  }, \" Reset Filters \")])])])]), _createCommentVNode(\" Delete Confirmation Modal \"), $data.showDeleteModal ? (_openBlock(), _createElementBlock(\"div\", _hoisted_25, [_createElementVNode(\"div\", _hoisted_26, [_createElementVNode(\"div\", _hoisted_27, [_createElementVNode(\"div\", _hoisted_28, [_cache[33] || (_cache[33] = _createElementVNode(\"h5\", {\n    class: \"modal-title\"\n  }, \"Confirm Delete\", -1 /* HOISTED */)), _createElementVNode(\"button\", {\n    type: \"button\",\n    class: \"btn-close\",\n    onClick: _cache[6] || (_cache[6] = $event => $data.showDeleteModal = false)\n  })]), _createElementVNode(\"div\", _hoisted_29, [_createElementVNode(\"p\", null, \"Are you sure you want to delete the charging station \\\"\" + _toDisplayString($data.stationToDelete?.name) + \"\\\"?\", 1 /* TEXT */), _cache[34] || (_cache[34] = _createElementVNode(\"p\", {\n    class: \"text-danger\"\n  }, \"This action cannot be undone.\", -1 /* HOISTED */))]), _createElementVNode(\"div\", _hoisted_30, [_createElementVNode(\"button\", {\n    type: \"button\",\n    class: \"btn btn-secondary\",\n    onClick: _cache[7] || (_cache[7] = $event => $data.showDeleteModal = false)\n  }, \"Cancel\"), _createElementVNode(\"button\", {\n    type: \"button\",\n    class: \"btn btn-danger\",\n    onClick: _cache[8] || (_cache[8] = (...args) => $options.deleteSelectedStation && $options.deleteSelectedStation(...args))\n  }, \"Delete\")])])])])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","id","ref","style","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createCommentVNode","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","$data","selectedStation","_hoisted_10","_toDisplayString","name","_hoisted_11","_normalizeClass","$options","getStatusBadgeClass","status","_hoisted_12","address","_hoisted_13","_hoisted_14","powerOutput","_hoisted_15","connectorType","pricePerKwh","_hoisted_16","availableHours","_hoisted_17","open","close","_hoisted_18","owner","username","canManageStation","_hoisted_19","_createVNode","_component_router_link","to","_id","_cache","onClick","$event","confirmDelete","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","for","mapFilters","onChange","args","applyMapFilters","value","_hoisted_24","resetMapFilters","showDeleteModal","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","type","_hoisted_29","stationToDelete","_hoisted_30","deleteSelectedStation"],"sources":["C:\\Users\\admin\\OneDrive\\Desktop\\charge-spot-finder\\frontend\\src\\views\\MapView.vue"],"sourcesContent":["<template>\n  <div class=\"map-view\">\n    <h2 class=\"mb-3\">Charging Stations Map</h2>\n    \n    <div class=\"row\">\n      <div class=\"col-md-8\">\n        <!-- Map Container -->\n        <div class=\"card mb-4\">\n          <div class=\"card-body p-0\">\n            <div id=\"map\" ref=\"mapContainer\" class=\"map-container\"></div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"col-md-4\">\n        <!-- Station Details Panel -->\n        <div class=\"card mb-4\">\n          <div class=\"card-header bg-primary text-white\">\n            <h5 class=\"mb-0\">Station Details</h5>\n          </div>\n          <div class=\"card-body\">\n            <div v-if=\"selectedStation\">\n              <h4>{{ selectedStation.name }}</h4>\n              <div class=\"mb-2\">\n                <span :class=\"getStatusBadgeClass(selectedStation.status)\">\n                  {{ selectedStation.status }}\n                </span>\n              </div>\n              \n              <div class=\"station-details\">\n                <p v-if=\"selectedStation.address\" class=\"mb-2\">\n                  <i class=\"bi bi-geo-alt\"></i> <strong>Address:</strong> {{ selectedStation.address }}\n                </p>\n                <p class=\"mb-2\">\n                  <i class=\"bi bi-lightning-charge\"></i> <strong>Power Output:</strong> {{ selectedStation.powerOutput }} kW\n                </p>\n                <p class=\"mb-2\">\n                  <i class=\"bi bi-plug\"></i> <strong>Connector Type:</strong> {{ selectedStation.connectorType }}\n                </p>\n                <p v-if=\"selectedStation.pricePerKwh\" class=\"mb-2\">\n                  <i class=\"bi bi-currency-dollar\"></i> <strong>Price:</strong> ${{ selectedStation.pricePerKwh }} per kWh\n                </p>\n                <p v-if=\"selectedStation.availableHours\" class=\"mb-2\">\n                  <i class=\"bi bi-clock\"></i> <strong>Hours:</strong> \n                  {{ selectedStation.availableHours.open }} - {{ selectedStation.availableHours.close }}\n                </p>\n                <p class=\"mb-2 text-muted\">\n                  <small>Added by: {{ selectedStation.owner?.username || 'Unknown' }}</small>\n                </p>\n              </div>\n              \n              <div class=\"mt-3\" v-if=\"canManageStation(selectedStation)\">\n                <router-link \n                  :to=\"`/stations/${selectedStation._id}/edit`\" \n                  class=\"btn btn-sm btn-outline-secondary me-2\"\n                >\n                  <i class=\"bi bi-pencil\"></i> Edit\n                </router-link>\n                <button \n                  class=\"btn btn-sm btn-outline-danger\"\n                  @click=\"confirmDelete(selectedStation)\"\n                >\n                  <i class=\"bi bi-trash\"></i> Delete\n                </button>\n              </div>\n            </div>\n            <div v-else class=\"text-center py-4\">\n              <i class=\"bi bi-map-fill text-muted\" style=\"font-size: 3rem;\"></i>\n              <p class=\"mt-3 text-muted\">Select a station on the map to view details</p>\n            </div>\n          </div>\n        </div>\n        \n        <!-- Filter Panel -->\n        <div class=\"card\">\n          <div class=\"card-header bg-light\">\n            <h5 class=\"mb-0\">Filters</h5>\n          </div>\n          <div class=\"card-body\">\n            <div class=\"mb-3\">\n              <label for=\"statusMapFilter\" class=\"form-label\">Status</label>\n              <select\n                id=\"statusMapFilter\"\n                class=\"form-select\"\n                v-model=\"mapFilters.status\"\n                @change=\"applyMapFilters\"\n              >\n                <option value=\"\">All Statuses</option>\n                <option value=\"Active\">Active</option>\n                <option value=\"Inactive\">Inactive</option>\n                <option value=\"Maintenance\">Maintenance</option>\n              </select>\n            </div>\n            \n            <div class=\"mb-3\">\n              <label for=\"connectorMapFilter\" class=\"form-label\">Connector Type</label>\n              <select\n                id=\"connectorMapFilter\"\n                class=\"form-select\"\n                v-model=\"mapFilters.connectorType\"\n                @change=\"applyMapFilters\"\n              >\n                <option value=\"\">All Connectors</option>\n                <option value=\"Type 1\">Type 1</option>\n                <option value=\"Type 2\">Type 2</option>\n                <option value=\"CCS\">CCS</option>\n                <option value=\"CHAdeMO\">CHAdeMO</option>\n                <option value=\"Tesla\">Tesla</option>\n              </select>\n            </div>\n            \n            <button class=\"btn btn-secondary w-100\" @click=\"resetMapFilters\">\n              Reset Filters\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Delete Confirmation Modal -->\n    <div v-if=\"showDeleteModal\" class=\"modal fade show\" style=\"display: block; background-color: rgba(0,0,0,0.5)\">\n      <div class=\"modal-dialog\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 class=\"modal-title\">Confirm Delete</h5>\n            <button type=\"button\" class=\"btn-close\" @click=\"showDeleteModal = false\"></button>\n          </div>\n          <div class=\"modal-body\">\n            <p>Are you sure you want to delete the charging station \"{{ stationToDelete?.name }}\"?</p>\n            <p class=\"text-danger\">This action cannot be undone.</p>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" @click=\"showDeleteModal = false\">Cancel</button>\n            <button type=\"button\" class=\"btn btn-danger\" @click=\"deleteSelectedStation\">Delete</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapActions, mapGetters } from 'vuex';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\n\n// Fix Leaflet icon issue\ndelete L.Icon.Default.prototype._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\n  iconUrl: require('leaflet/dist/images/marker-icon.png'),\n  shadowUrl: require('leaflet/dist/images/marker-shadow.png')\n});\n\nexport default {\n  name: 'MapView',\n  data() {\n    return {\n      map: null,\n      markerLayer: null,\n      markers: {},\n      selectedStation: null,\n      showDeleteModal: false,\n      stationToDelete: null,\n      mapFilters: {\n        status: '',\n        connectorType: ''\n      },\n      isUnmounting: false,\n      mapEventListeners: []\n    }\n  },\n  computed: {\n    ...mapGetters(['allStations', 'loading', 'isLoggedIn', 'user']),\n    filteredMapStations() {\n      let filtered = [...this.allStations];\n      \n      if (this.mapFilters.status) {\n        filtered = filtered.filter(station => station.status === this.mapFilters.status);\n      }\n      \n      if (this.mapFilters.connectorType) {\n        filtered = filtered.filter(station => station.connectorType === this.mapFilters.connectorType);\n      }\n      \n      return filtered;\n    }\n  },\n  methods: {\n    ...mapActions(['fetchStations', 'deleteStation']),\n    \n    // Helper method to validate coordinates\n    isValidCoordinate(location) {\n      if (!location || location.latitude === undefined || location.longitude === undefined) return false;\n      \n      const lat = parseFloat(location.latitude);\n      const lng = parseFloat(location.longitude);\n      \n      return !isNaN(lat) && !isNaN(lng) && \n             lat >= -90 && lat <= 90 && \n             lng >= -180 && lng <= 180;\n    },\n    \n    initializeMap() {\n      try {\n        // Check if map container exists\n        if (!this.$refs.mapContainer) {\n          console.error('Map container not found');\n          return;\n        }\n\n        // Prevent re-initialization if map already exists\n        if (this.map) {\n          console.warn('Map already initialized');\n          return;\n        }\n\n        // Add a flag to track unmounting state\n        this.isUnmounting = false;\n\n        // Initialize the map with Leaflet with zoomAnimation disabled\n        this.map = L.map(this.$refs.mapContainer, {\n          zoomAnimation: false, // Disable zoom animation to prevent the _latLngToNewLayerPoint error\n          fadeAnimation: false  // Disable fade animation for better stability\n        }).setView([39.8283, -98.5795], 4); // Center of USA\n        \n        // Add OpenStreetMap tile layer (free)\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n          maxZoom: 19\n        }).addTo(this.map);\n        \n        // Create a layer group for markers\n        this.markerLayer = L.layerGroup().addTo(this.map);\n        \n        // Add scale control\n        L.control.scale().addTo(this.map);\n        \n        // Update markers when map is ready\n        this.updateMapMarkers();\n        \n        // Check for station ID in query params\n        const stationId = this.$route.query.id;\n        if (stationId) {\n          // Find the station in the current list\n          const station = this.allStations.find(s => s._id === stationId);\n          if (station) {\n            this.selectedStation = station;\n            \n            // Center map on the station\n            if (station.location && this.isValidCoordinate(station.location)) {\n              const lat = parseFloat(station.location.latitude);\n              const lng = parseFloat(station.location.longitude);\n              this.map.setView([lat, lng], 15);\n            }\n          }\n        }\n        \n        // Handle map click to deselect station - store reference to remove later\n        const mapClickHandler = () => {\n          // Skip if component is unmounting\n          if (this.isUnmounting) return;\n          \n          // Check if any popups are open by looking at the map container\n          if (this.$refs.mapContainer) {\n            const popupElements = this.$refs.mapContainer.querySelectorAll('.leaflet-popup');\n            if (popupElements.length === 0) {\n              // No popups are open, so deselect the station\n              this.selectedStation = null;\n            }\n          }\n        };\n        \n        this.map.on('click', mapClickHandler);\n        \n        // Store event listeners for later cleanup\n        this.mapEventListeners.push({\n          event: 'click',\n          handler: mapClickHandler\n        });\n        \n        // Add error handling for map events\n        this.map.on('error', (e) => {\n          console.error('Leaflet map error:', e);\n        });\n      } catch (error) {\n        console.error('Error initializing map:', error);\n      }\n    },\n    \n    // Create a custom icon for markers\n    createMarkerIcon(color = '#3388ff') {\n      return L.divIcon({\n        className: 'custom-map-marker',\n        html: `<div style=\"background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.4);\"></div>`,\n        iconSize: [24, 24],\n        iconAnchor: [12, 12],\n        popupAnchor: [0, -12]\n      });\n    },\n    \n    updateMapMarkers() {\n      // Skip if map is not initialized or component is unmounting\n      if (!this.map || !this.markerLayer || this.isUnmounting) return;\n      \n      try {\n        // Clear existing markers\n        this.markerLayer.clearLayers();\n        \n        // Clean up marker references\n        Object.keys(this.markers).forEach(key => {\n          if (this.markers[key]) {\n            this.markers[key].off();\n          }\n        });\n        this.markers = {};\n        \n        // Add markers for filtered stations\n        this.filteredMapStations.forEach(station => {\n          if (!station.location || !this.isValidCoordinate(station.location)) return;\n          \n          // Parse coordinates to ensure they're valid numbers\n          const lat = parseFloat(station.location.latitude);\n          const lng = parseFloat(station.location.longitude);\n          \n          // Skip invalid coordinates\n          if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {\n            console.warn(`Invalid coordinates for station ${station.name}: ${lat}, ${lng}`);\n            return;\n          }\n          \n          // Create marker with appropriate icon based on status\n          const color = this.getStatusColor(station.status);\n          const marker = L.marker([lat, lng], {\n            icon: this.createMarkerIcon(color)\n          });\n          \n          // Create popup content\n          const popupContent = `\n            <strong>${station.name}</strong><br>\n            <span class=\"badge ${this.getStatusBadgeClass(station.status)}\">${station.status}</span><br>\n            ${station.connectorType} - ${station.powerOutput} kW\n          `;\n          \n          // Bind popup to marker\n          marker.bindPopup(popupContent);\n          \n          // Add click handler\n          const markerClickHandler = () => {\n            if (!this.isUnmounting) {\n              this.selectedStation = station;\n            }\n          };\n          \n          marker.on('click', markerClickHandler);\n          \n          // Add marker to layer and store reference\n          marker.addTo(this.markerLayer);\n          this.markers[station._id] = marker;\n        });\n      } catch (error) {\n        console.error('Error updating map markers:', error);\n      }\n    },\n    \n    getStatusBadgeClass(status) {\n      const classes = {\n        'Active': 'badge bg-success',\n        'Inactive': 'badge bg-secondary',\n        'Maintenance': 'badge bg-warning text-dark'\n      };\n      return classes[status] || 'badge bg-secondary';\n    },\n    \n    getStatusColor(status) {\n      const colors = {\n        'Active': '#28a745',     // Green\n        'Inactive': '#6c757d',   // Gray\n        'Maintenance': '#ffc107' // Yellow\n      };\n      return colors[status] || '#6c757d';\n    },\n    \n    applyMapFilters() {\n      this.updateMapMarkers();\n    },\n    \n    resetMapFilters() {\n      this.mapFilters = {\n        status: '',\n        connectorType: ''\n      };\n      this.updateMapMarkers();\n    },\n    \n    canManageStation(station) {\n      if (!this.isLoggedIn || !this.user) return false;\n      \n      // User can manage if they are the owner or an admin\n      return (station.owner?._id === this.user._id) || (this.user.role === 'admin');\n    },\n    \n    confirmDelete(station) {\n      this.stationToDelete = station;\n      this.showDeleteModal = true;\n    },\n    \n    async deleteSelectedStation() {\n      if (!this.stationToDelete) return;\n      \n      try {\n        await this.deleteStation(this.stationToDelete._id);\n        this.showDeleteModal = false;\n        this.stationToDelete = null;\n        this.selectedStation = null;\n        \n        // Update markers after deletion\n        this.updateMapMarkers();\n      } catch (error) {\n        console.error('Error deleting station:', error);\n      }\n    }\n  },\n  mounted() {\n    // Ensure the map container is properly rendered before initializing the map\n    this.$nextTick(() => {\n      this.fetchStations().then(() => {\n        // Small delay to ensure DOM is fully rendered\n        setTimeout(() => {\n          if (!this.isUnmounting) {\n            this.initializeMap();\n          }\n        }, 100);\n      });\n    });\n  },\n  beforeUnmount() {\n    // Set unmounting flag to prevent further interactions\n    this.isUnmounting = true;\n    \n    // Clean up map instance and all event listeners\n    if (this.map) {\n      try {\n        // Remove specific event listeners first\n        this.mapEventListeners.forEach(listener => {\n          this.map.off(listener.event, listener.handler);\n        });\n        \n        // Then remove all other event listeners\n        this.map.off();\n        \n        // Clear all markers and layers\n        if (this.markerLayer) {\n          this.markerLayer.clearLayers();\n          this.markerLayer.remove();\n          this.markerLayer = null;\n        }\n        \n        // Clear all markers references\n        Object.keys(this.markers).forEach(key => {\n          if (this.markers[key]) {\n            this.markers[key].off();\n            if (this.map) this.markers[key].remove();\n          }\n        });\n        this.markers = {};\n        \n        // Remove the map instance with a small delay to ensure all animations are complete\n        setTimeout(() => {\n          if (this.map) {\n            this.map.remove();\n            this.map = null;\n          }\n        }, 100);\n      } catch (error) {\n        console.error('Error cleaning up map:', error);\n        // Ensure map is set to null even if there's an error\n        this.map = null;\n      }\n    }\n  },\n  watch: {\n    allStations() {\n      if (this.map) {\n        this.updateMapMarkers();\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.map-container {\n  height: 600px;\n  width: 100%;\n  border-radius: 0.25rem;\n}\n\n@media (max-width: 768px) {\n  .map-container {\n    height: 400px;\n  }\n}\n\n/* Override Leaflet styles */\n:deep(.leaflet-popup-content-wrapper) {\n  border-radius: 8px;\n}\n\n:deep(.leaflet-popup-content) {\n  margin: 12px 16px;\n  line-height: 1.5;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}